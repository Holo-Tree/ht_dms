// github.com/paulirish/jquery-ajax-localstorage-cache
// dependent on Modernizr's localStorage test
(function($) {
$.ajaxPrefilter(function(e,a,t){function c(){var e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(a){return!1}}if(c()&&e.localCache){var r=e.cacheTTL||5,o=e.cacheKey||e.url.replace(/jQuery.*/,"")+e.type+(e.data||"");e.isCacheValid&&!e.isCacheValid()&&localStorage.removeItem(o);var l=localStorage.getItem(o+"cachettl");l&&l<+new Date&&(localStorage.removeItem(o),localStorage.removeItem(o+"cachettl"),l="expired");var s=localStorage.getItem(o);s?(0===e.dataType.indexOf("json")&&(s=JSON.parse(s)),e.success(s),t.abort()):(e.success&&(e.realsuccess=e.success),e.success=function(a){var t=a;0===this.dataType.indexOf("json")&&(t=JSON.stringify(a));try{localStorage.setItem(o,t)}catch(c){localStorage.removeItem(o),localStorage.removeItem(o+"cachettl"),e.cacheError&&e.cacheError(c,o,t)}e.realsuccess&&e.realsuccess(a)},l&&"expired"!==l||localStorage.setItem(o+"cachettl",+new Date+36e5*r))}});
})(jQuery);
